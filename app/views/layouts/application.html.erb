<!DOCTYPE html>
<html>
  <head>
    <title><%= content_for(:title) || "Proto Behavior" %></title>
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="application-name" content="Proto Behavior">
    <meta name="mobile-web-app-capable" content="yes">
    <%= csrf_meta_tags %>
    <%= csp_meta_tag %>

    <%= yield :head %>

    <%# Enable PWA manifest for installable apps (make sure to enable in config/routes.rb too!) %>
    <%#= tag.link rel: "manifest", href: pwa_manifest_path(format: :json) %>

    <link rel="icon" href="/icon.png" type="image/png">
    <link rel="icon" href="/icon.svg" type="image/svg+xml">
    <link rel="apple-touch-icon" href="/icon.png">

    <%# Includes all stylesheet files in app/assets/stylesheets %>
    <%= stylesheet_link_tag :app, "data-turbo-track": "reload" %>
    <%= javascript_importmap_tags %>

    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        background-color: #1e1e1e;
        color: #cccccc;
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
        font-size: 13px;
        line-height: 1.4;
        overflow: hidden;
        height: 100vh;
      }

      /* VSCode Layout */
      .vscode-container {
        display: flex;
        flex-direction: column;
        height: 100vh;
        width: 100vw;
      }

      /* Top Bar */
      .titlebar {
        height: 35px;
        background-color: #323233;
        display: flex;
        align-items: center;
        padding: 0 8px;
        border-bottom: 1px solid #2d2d30;
        position: relative;
        z-index: 200;
      }

      .window-controls {
        display: flex;
        gap: 8px;
      }

      .window-dot {
        width: 12px;
        height: 12px;
        border-radius: 50%;
      }

      .window-dot.red { background-color: #ff5f56; }
      .window-dot.yellow { background-color: #ffbd2e; }
      .window-dot.green { background-color: #27c93f; }

      .search-bar {
        flex: 1;
        max-width: 600px;
        margin: 0 auto;
        display: flex !important;
        align-items: center !important;
        gap: 8px !important;
      }

      .search-bar input {
        width: 100%;
        background-color: #3c3c3c;
        border: 1px solid #3c3c3c;
        color: #cccccc;
        padding: 4px 8px;
        border-radius: 4px;
        font-size: 13px;
        outline: none;
      }

      .search-bar input:focus {
        border-color: #007acc;
      }

      .search-bar button {
        flex-shrink: 0;
      }

      @keyframes shake {
        0%, 100% { transform: translateX(0); }
        10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }
        20%, 40%, 60%, 80% { transform: translateX(5px); }
      }

      .shake {
        animation: shake 0.5s;
      }

      /* Scrollbar Styling */
      ::-webkit-scrollbar {
        width: 10px;
        height: 10px;
      }

      ::-webkit-scrollbar-track {
        background: transparent;
      }

      ::-webkit-scrollbar-thumb {
        background: #424242;
        border-radius: 5px;
      }

      ::-webkit-scrollbar-thumb:hover {
        background: #4e4e4e;
      }

      /* Firefox */
      * {
        scrollbar-width: thin;
        scrollbar-color: #424242 transparent;
      }

      /* Main Content Area */
      .main-container {
        display: flex;
        flex: 1;
        overflow: hidden;
      }

      /* Activity Bar (Left-most vertical bar) */
      .activity-bar {
        width: 48px;
        background-color: #333333;
        border-right: 1px solid #2d2d30;
        display: flex;
        flex-direction: column;
        align-items: center;
        padding: 8px 0;
      }

      .activity-icon {
        width: 48px;
        height: 48px;
        display: flex;
        align-items: center;
        justify-content: center;
        color: #858585;
        cursor: pointer;
        position: relative;
      }

      .activity-icon:hover {
        color: #cccccc;
      }

      .activity-icon.active {
        color: #ffffff;
      }

      .activity-icon.active::before {
        content: '';
        position: absolute;
        left: 0;
        top: 0;
        bottom: 0;
        width: 2px;
        background-color: #007acc;
      }

      .activity-badge {
        position: absolute;
        top: 8px;
        right: 8px;
        background-color: #007acc;
        color: #ffffff;
        font-size: 9px;
        padding: 2px 4px;
        border-radius: 10px;
        min-width: 16px;
        text-align: center;
      }

      /* Sidebar */
      .sidebar {
        width: 220px;
        background-color: #252526;
        border-right: 1px solid #2d2d30;
        display: flex;
        flex-direction: column;
        position: relative;
        z-index: 1;
        overflow: hidden;
      }

      .sidebar-resize-handle {
        position: absolute;
        top: 0;
        right: 0;
        bottom: 0;
        width: 4px;
        cursor: ew-resize;
        z-index: 100;
      }

      .sidebar-resize-handle:hover {
        background-color: #007acc;
      }

      .sidebar-header {
        padding: 8px 20px;
        font-size: 11px;
        color: #cccccc;
        text-transform: uppercase;
        font-weight: 600;
        display: flex;
        align-items: center;
        justify-content: space-between;
        white-space: nowrap;
      }

      .sidebar-section {
        margin-bottom: 12px;
      }

      .sidebar-section-title {
        padding: 4px 20px;
        font-size: 11px;
        color: #cccccc;
        cursor: pointer;
        display: flex;
        align-items: center;
        gap: 4px;
        white-space: nowrap;
      }

      .sidebar-section-title:hover {
        background-color: #2a2d2e;
      }

      .chevron {
        font-size: 10px;
      }

      .sidebar-item {
        padding: 2px 20px 2px 32px;
        color: #cccccc;
        cursor: pointer;
        display: flex;
        align-items: center;
        gap: 6px;
        font-size: 13px;
        white-space: nowrap;
      }

      .sidebar-item:hover {
        background-color: #2a2d2e;
      }

      .sidebar-item.selected {
        background-color: #37373d;
      }

      .file-icon {
        width: 16px;
        height: 16px;
        display: inline-block;
      }

      .item-badge {
        margin-left: auto;
        width: 6px;
        height: 6px;
        border-radius: 50%;
        background-color: #89d185;
      }

      /* Editor Area */
      .editor-container {
        flex: 1;
        display: flex;
        flex-direction: column;
        background-color: #1e1e1e;
        min-width: 0;
      }

      .editor-wrapper {
        display: flex;
        flex-direction: column;
        flex: 1;
        overflow: hidden;
      }

      .tab-bar {
        height: 35px;
        background-color: #2d2d30;
        border-bottom: 1px solid #2d2d30;
        display: flex;
        align-items: center;
      }

      .tab {
        padding: 0 16px;
        height: 100%;
        display: flex;
        align-items: center;
        gap: 6px;
        color: #969696;
        cursor: pointer;
        border-right: 1px solid #252526;
        font-size: 13px;
      }

      .tab.active {
        background-color: #1e1e1e;
        color: #ffffff;
      }

      .tab:hover:not(.active) {
        background-color: #2a2d2e;
      }

      .editor-content {
        flex: 1;
        overflow-y: auto;
        padding: 20px;
      }

      /* Panel (Bottom Terminal Area) */
      .panel {
        height: 300px;
        background-color: #181818;
        border-top: 1px solid #2d2d30;
        display: flex;
        flex-direction: column;
        position: relative;
        transition: height 0.3s ease;
        overflow: hidden;
      }

      .panel-resize-handle {
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 4px;
        cursor: ns-resize;
        z-index: 100;
      }

      .panel-resize-handle:hover {
        background-color: #007acc;
      }

      .panel-header {
        height: 35px;
        background-color: #252526;
        display: flex;
        align-items: center;
        padding: 0 8px;
        gap: 20px;
      }

      .panel-tab {
        padding: 0 12px;
        height: 100%;
        display: flex;
        align-items: center;
        color: #969696;
        cursor: pointer;
        font-size: 13px;
        border-bottom: 1px solid transparent;
      }

      .panel-tab.active {
        color: #ffffff;
        border-bottom-color: #007acc;
      }

      .panel-tab:hover:not(.active) {
        color: #cccccc;
      }

      .panel-controls {
        margin-left: auto;
        display: flex;
        gap: 8px;
      }

      .panel-control {
        color: #858585;
        cursor: pointer;
        padding: 4px;
        font-size: 18px;
      }

      .panel-control:hover {
        color: #cccccc;
      }

      .panel-content {
        flex: 1;
        overflow-y: auto;
        padding: 8px 12px;
        font-family: 'Courier New', monospace;
        font-size: 13px;
      }

      .terminal-line {
        margin-bottom: 4px;
      }

      .terminal-prompt {
        color: #4ec9b0;
        margin-right: 8px;
      }

      .terminal-input {
        background-color: #181818 !important;
        border: none !important;
        color: #ffffff !important;
        font-family: 'Courier New', monospace;
        font-size: 13px;
        outline: none !important;
        flex: 1;
        width: 100%;
        box-shadow: none !important;
      }

      .terminal-input:focus {
        background-color: #181818 !important;
        color: #ffffff !important;
        border: none !important;
        outline: none !important;
        box-shadow: none !important;
      }

      .terminal-input::placeholder {
        color: #666666;
      }

      input[type="text"].terminal-input {
        background-color: #181818 !important;
        color: #ffffff !important;
      }

      .terminal-input-line {
        display: flex;
        align-items: center;
      }

      /* Status Bar */
      .status-bar {
        height: 22px;
        background-color: #007acc;
        display: flex;
        align-items: center;
        padding: 0 8px;
        font-size: 12px;
        color: #ffffff;
        gap: 12px;
      }

      .status-item {
        display: flex;
        align-items: center;
        gap: 4px;
      }

      .status-bar-right {
        margin-left: auto;
        display: flex;
        gap: 12px;
      }

      /* Content Styles */
      h1 {
        color: #ffffff;
        font-size: 24px;
        font-weight: 400;
        margin-bottom: 20px;
      }

      .subtitle {
        color: #858585;
        font-size: 14px;
        margin-bottom: 30px;
      }

      .btn-primary {
        background-color: #0e639c;
        border: none;
        color: #ffffff;
        padding: 6px 14px;
        border-radius: 2px;
        cursor: pointer;
        font-size: 13px;
        transition: background-color 0.1s;
      }

      .btn-primary:hover {
        background-color: #1177bb;
      }

      .btn-secondary {
        background-color: #3c3c3c;
        border: none;
        color: #cccccc;
        padding: 6px 14px;
        border-radius: 2px;
        cursor: pointer;
        font-size: 13px;
        text-decoration: none;
        display: inline-block;
        transition: background-color 0.1s;
      }

      .btn-secondary:hover {
        background-color: #505050;
      }

      .result-item {
        background-color: #252526;
        border-left: 3px solid #3c3c3c;
        padding: 12px 16px;
        margin-bottom: 8px;
      }

      .result-item.pass {
        border-left-color: #388a34;
      }

      .result-item.fail {
        border-left-color: #d72828;
      }

      .result-item.error {
        border-left-color: #c9a000;
      }

      .result-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 8px;
      }

      .result-title {
        color: #cccccc;
        font-size: 14px;
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .badge {
        padding: 2px 6px;
        border-radius: 2px;
        font-size: 11px;
        font-weight: 600;
        text-transform: uppercase;
      }

      .badge-success {
        background-color: #388a34;
        color: #ffffff;
      }

      .badge-danger {
        background-color: #d72828;
        color: #ffffff;
      }

      .badge-warning {
        background-color: #c9a000;
        color: #000000;
      }

      .text-success {
        color: #89d185;
      }

      .text-danger {
        color: #f48771;
      }

      .text-warning {
        color: #dcdcaa;
      }

      .text-muted {
        color: #858585;
        font-size: 12px;
      }

      .summary-box {
        background-color: #252526;
        border-left: 3px solid #007acc;
        padding: 16px;
        margin-bottom: 20px;
      }

      .summary-box strong {
        color: #ffffff;
      }

      .button-group {
        display: flex;
        gap: 12px;
        margin-top: 20px;
      }

      a {
        color: #4fc1ff;
        text-decoration: none;
      }

      a:hover {
        text-decoration: underline;
      }
    </style>
  </head>

  <body>
    <%= yield %>

    <script>
      document.addEventListener('DOMContentLoaded', function() {
        // パネル（ターミナル）のリサイズ機能
        const panel = document.querySelector('.panel');
        const resizeHandle = document.querySelector('.panel-resize-handle');

        if (panel && resizeHandle) {
          let isResizing = false;
          let startY = 0;
          let startHeight = 0;

          resizeHandle.addEventListener('mousedown', function(e) {
            isResizing = true;
            startY = e.clientY;
            startHeight = panel.offsetHeight;
            document.body.style.cursor = 'ns-resize';
            // ドラッグ中はトランジションを無効化
            panel.style.transition = 'none';
            e.preventDefault();
          });

          document.addEventListener('mousemove', function(e) {
            if (!isResizing) return;

            const delta = startY - e.clientY;
            const newHeight = startHeight + delta;

            // 最小高さ100px、最大高さ800px
            if (newHeight >= 100 && newHeight <= 800) {
              panel.style.height = newHeight + 'px';

              // パネルが閉じた状態（35px）からリサイズされた場合、トグルボタンを⌄に戻す
              const panelToggle = document.querySelector('.panel-toggle');
              if (panelToggle && panelToggle.textContent === '^') {
                panelToggle.textContent = '⌄';
              }
            }
          });

          document.addEventListener('mouseup', function() {
            if (isResizing) {
              isResizing = false;
              document.body.style.cursor = '';
              // ドラッグ終了後、トランジションを再度有効化
              panel.style.transition = 'height 0.3s ease';
            }
          });
        }

        // サイドバーのリサイズ機能
        const sidebar = document.querySelector('.sidebar');
        const sidebarResizeHandle = document.querySelector('.sidebar-resize-handle');

        if (sidebar && sidebarResizeHandle) {
          let isSidebarResizing = false;
          let startX = 0;
          let startWidth = 0;

          sidebarResizeHandle.addEventListener('mousedown', function(e) {
            isSidebarResizing = true;
            startX = e.clientX;
            startWidth = sidebar.offsetWidth;
            document.body.style.cursor = 'ew-resize';
            e.preventDefault();
          });

          document.addEventListener('mousemove', function(e) {
            if (!isSidebarResizing) return;

            const delta = e.clientX - startX;
            const newWidth = startWidth + delta;

            // 最小幅48px、最大幅600px
            if (newWidth >= 48 && newWidth <= 600) {
              sidebar.style.width = newWidth + 'px';
            }
          });

          document.addEventListener('mouseup', function() {
            if (isSidebarResizing) {
              isSidebarResizing = false;
              document.body.style.cursor = '';
            }
          });
        }
      });
    </script>
  </body>
</html>
