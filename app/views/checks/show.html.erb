<div class="container mt-5">
  <h1>チェック結果</h1>

  <div class="card mb-4">
    <div class="card-body">
      <h5 class="card-title">対象URL</h5>
      <p class="card-text"><%= @check_session.target_url %></p>

      <div class="row">
        <div class="col-md-6">
          <strong>実行日時:</strong> <%= @check_session.started_at.strftime('%Y-%m-%d %H:%M:%S') %>
        </div>
        <div class="col-md-6">
          <strong>ステータス:</strong>
          <span class="badge bg-<%= @check_session.status == 'completed' ? 'success' : 'warning' %>">
            <%= @check_session.status %>
          </span>
        </div>
      </div>
    </div>
  </div>

  <h2>チェック結果詳細</h2>

  <% if @check_results.any? %>
    <% pass_count = @check_results.count { |r| r.status == 'PASS' } %>
    <% fail_count = @check_results.count { |r| r.status == 'FAIL' } %>
    <% error_count = @check_results.count { |r| r.status == 'ERROR' } %>

    <div class="alert alert-info">
      <strong>サマリー:</strong>
      合格: <%= pass_count %> /
      不合格: <%= fail_count %> /
      エラー: <%= error_count %> /
      合計: <%= @check_results.count %>
    </div>

    <div class="list-group">
      <% @check_results.each do |result| %>
        <div class="list-group-item">
          <div class="d-flex w-100 justify-content-between">
            <h5 class="mb-1">
              <% if result.status == 'PASS' %>
                <span class="text-success">✓</span>
              <% elsif result.status == 'FAIL' %>
                <span class="text-danger">✗</span>
              <% else %>
                <span class="text-warning">!</span>
              <% end %>
              <%= result.check_number %>: <%= result.description %>
            </h5>
            <span class="badge bg-<%= result.status == 'PASS' ? 'success' : (result.status == 'FAIL' ? 'danger' : 'warning') %>">
              <%= result.status %>
            </span>
          </div>
          <% if result.note.present? %>
            <p class="mb-1 text-muted"><strong>補足:</strong> <%= result.note %></p>
          <% end %>
        </div>
      <% end %>
    </div>
  <% else %>
    <p class="text-muted">まだチェック結果がありません</p>
  <% end %>

  <div class="mt-4">
    <%= link_to "新しいチェックを実行", new_check_path, class: "btn btn-primary" %>
    <%= link_to "チェック一覧", checks_path, class: "btn btn-secondary" %>
  </div>
</div>
